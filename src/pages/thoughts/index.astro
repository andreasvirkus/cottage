---
import { getCollection } from 'astro:content'

import { getConicGradient } from '../../utils/conic-art'
import PostFeed from '../../components/PostFeed.astro'

const tags = new Set<string>()
let posts = ((await getCollection('thoughts')) || [])
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .map((post) => {
    post.data.tags?.forEach((tag: string) => tags.add(tag))
    return {
      ...post,
      // Generate custom gradient for each post, seeded by slug
      data: {
        ...post.data,
        heroImage: getConicGradient(post.slug || ''),
      },
    }
  })
---

<PostFeed posts={posts} tags={Array.from(tags)} />

<style>
.tags {
  position: relative;
  display: flex;
  flex-wrap: wrap;
  column-gap: 1.5em;
  row-gap: 0.5em;
  margin-bottom: 2em;
  overflow: hidden; /* Hide seperators when wrapping */
}

.tag::before {
  content: '*';
  position: absolute;
  translate: -1.1em 0;
}
</style>